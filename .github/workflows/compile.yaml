name: CI Workflow

on:
  push:
    branches:
      - main

jobs:
  compile-scss:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          
      - name: Install Dependencies
        run: |
          npm install grunt
          npm install grunt-cli
          npm install load-grunt-tasks
          npm install grunt-contrib-uglify
          npm install grunt-contrib-qunit
          npm install grunt-contrib-connect
          npm install grunt-contrib-cssmin
          npm install grunt-contrib-jshint
          npm install grunt-autoprefixer
          npm install grunt-zip
          npm install grunt-sass
          npm install node-sass
          npm install sass
          
      - name: Verify Grunt Installation
        run: npx grunt --version
        
      - name: Run Grunt Tasks
        run: |
          npx grunt sass --force
          npx grunt autoprefixer --force
          npx grunt cssmin --force
          
      - name: Commit and Push if changed
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add css/theme/*.css
          git diff --staged --quiet || (git commit -m "chore: compile SCSS to CSS [skip ci]" && git push)
